
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>WMS Scan App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        input, button { font-size: 1.2em; margin: 5px 0; width: 100%; padding: 10px; }
        .log { white-space: pre-wrap; background: #f0f0f0; padding: 10px; margin-top: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>WMS: —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–≤–∏–∂–µ–Ω–∏–µ</h1>

    <label>QR —Ç–æ–≤–∞—Ä–∞:</label>
    <input type="text" id="productQR" placeholder="–°–∫–∞–Ω–∏—Ä—É–π QR —Ç–æ–≤–∞—Ä–∞">

    <label>QR –ø–æ–ª–∫–∏:</label>
    <input type="text" id="locationQR" placeholder="–°–∫–∞–Ω–∏—Ä—É–π QR –ø–æ–ª–∫–∏">

    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</label>
    <input type="number" id="qty" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ" value="1">

    <label>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
    <input type="text" id="userName" placeholder="–ö—Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é">

    <label>ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:</label>
    <input type="text" id="deviceId" placeholder="–£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞" value="test-device">

    <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</label>
    <input type="text" id="note" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">

    <button onclick="move('putaway')">üì¶ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</button>
    <button onclick="move('pick')">üì§ –°–ø–∏—Å–∞–Ω–∏–µ</button>

    <div class="log" id="log">–ì–æ—Ç–æ–≤–æ –∫ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—é...</div>

    <script>
        const API_KEY = "supersecret123";
        const API_URL = "https://bf1ea7d4a0c5.ngrok-free.app";

        function log(msg) {
            document.getElementById("log").textContent = msg;
        }

        async function move(action) {
            const skuQR = document.getElementById("productQR").value.trim();
            const locQR = document.getElementById("locationQR").value.trim();
            const qty = parseInt(document.getElementById("qty").value, 10);
            const user = document.getElementById("userName").value.trim();
            const device = document.getElementById("deviceId").value.trim();
            const note = document.getElementById("note").value.trim();
            const op_id = "op_" + Date.now();

            if (!skuQR || !locQR || isNaN(qty)) {
                log("‚ùå –ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–ª—è");
                return;
            }

            try {
                const skuRes = await fetch(`${API_URL}/product?code=${encodeURIComponent(skuQR)}`, {
                    headers: { "X-API-Key": API_KEY }
                });
                const skuJson = await skuRes.json();
                const locRes = await fetch(`${API_URL}/location?code=${encodeURIComponent(locQR)}`, {
                    headers: { "X-API-Key": API_KEY }
                });
                const locJson = await locRes.json();

                const payload = {
                    sku: skuJson.sku,
                    loc_code: locJson.loc_code,
                    qty_delta: action === "putaway" ? qty : -qty,
                    action,
                    device_id: device,
                    user_name: user,
                    op_id,
                    note
                };

                const moveRes = await fetch(`${API_URL}/move`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "X-API-Key": API_KEY
                    },
                    body: JSON.stringify(payload)
                });

                const result = await moveRes.json();
                if (moveRes.ok) {
                    log(`‚úÖ –ì–æ—Ç–æ–≤–æ: ${action === "putaway" ? "–¥–æ–±–∞–≤–ª–µ–Ω–æ" : "—Å–ø–∏—Å–∞–Ω–æ"} ${qty} —à—Ç.
–û—Å—Ç–∞—Ç–æ–∫: ${result.new_qty}`);
                } else {
                    log(`‚ùå –û—à–∏–±–∫–∞: ${result.detail || "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"}`);
                }
            } catch (err) {
                log("‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: " + err.message);
            }
        }
    </script>
</body>
</html>
